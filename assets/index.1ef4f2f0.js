import{B as j,u as q}from"./useTable.2dfc64b8.js";import{p as Y,T as H,q as J,r as K,s as Q,t as Z,v as ee}from"./useForm.64137a1f.js";import{dA as A,a as L,aJ as te,b as ne,f as b,aK as oe,w as ie,v as B,U as ae,n as o,i as v,c7 as le,C as se,d9 as re,da as ce,eF as me,eG as ue,az as de,c as fe,dg as ge,aB as C,o as R,h as pe,B as E,j as ve,k as he}from"./index.c8efd86c.js";import{a as we}from"./download.b01f8fdc.js";import"./index.f0acda50.js";import"./index.17fa07c8.js";import"./index.95f8610f.js";import"./index.1cc2df02.js";import"./index.ae0eca88.js";import"./useSize.822cfd2a.js";import"./useWindowSizeFn.569f2c34.js";import"./useContentViewHeight.833d113a.js";import"./ArrowLeftOutlined.8ce689d7.js";import"./index.e7beea07.js";import"./index.b775b83d.js";import"./index.8f1c0509.js";import"./get.a8e0dbdb.js";import"./index.eb75c359.js";import"./FullscreenOutlined.5ec4a1b8.js";import"./index.59448792.js";import"./sortable.esm.c081a59d.js";import"./RedoOutlined.b14ae1e3.js";import"./scrollTo.877bd4fa.js";import"./index.93134645.js";import"./index.8a182ce2.js";import"./index.5bccfa61.js";import"./index.d99ed209.js";import"./_baseIteratee.813ccf6c.js";import"./index.650ee6e3.js";import"./useRefs.76e09c0b.js";import"./index.a13d6ad9.js";import"./index.4c128a7b.js";import"./uniqBy.8070035d.js";const Ie=[{title:"\u6587\u4EF6\u540D",dataIndex:"name",ellipsis:!0},{title:"\u6587\u4EF6\u7C7B\u578B",dataIndex:"contentType",ellipsis:!0},{title:"\u6587\u4EF6\u5927\u5C0F(Bytes)",dataIndex:"fileSize",ellipsis:!0},{title:"\u4E0A\u4F20\u65F6\u95F4",dataIndex:"createTime",ellipsis:!0}],_e=[{field:"name",label:"\u6587\u4EF6\u540D",component:"Input",colProps:{span:8}},{field:"createDateRange",label:"\u4E0A\u4F20\u65E5\u671F",component:"RangePicker",defaultValue:[A().startOf("month").format("YYYY-MM-DD"),A().endOf("month").format("YYYY-MM-DD")],componentProps:{valueFormat:"YYYY-MM-DD",showTime:!1},colProps:{span:8}}];L({name:"ImagePreview",components:{Image:Y,PreviewGroup:Y.PreviewGroup},props:{functional:te.bool,imageList:{type:Array}},setup(n){const{prefixCls:u}=ne("image-preview"),c=b(()=>{const{imageList:l}=n;return l?l.map(t=>oe(t)?{src:t,placeholder:!1}:t):[]});return{prefixCls:u,getImageList:c}}});var be="/assets/resume.6e209205.svg",Se="/assets/p-rotate.1d232189.svg",ye="/assets/scale.8d8ebde4.svg",Ce="/assets/unscale.99ad049c.svg",xe="/assets/unrotate.f9dd5a27.svg",p;(function(n){n[n.LOADING=0]="LOADING",n[n.DONE=1]="DONE",n[n.FAIL=2]="FAIL"})(p||(p={}));const Le={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},a="img-preview";var De=L({name:"ImagePreview",props:Le,emits:["img-load","img-error"],setup(n,{expose:u,emit:c}){const l=new Map,t=ie({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:p.LOADING,currentIndex:0,moveX:0,moveY:0,show:n.show}),h=B(null),f=B(null);function w(){m();const{index:e,imageList:i}=n;if(!i||!i.length)throw new Error("imageList is undefined");t.currentIndex=e,T(i[e])}function s(){t.imgScale=1,t.imgRotate=0,t.imgTop=0,t.imgLeft=0}function m(){const e=v(h);!e||(e.onmousewheel=S,document.body.addEventListener("DOMMouseScroll",S),document.ondragstart=function(){return!1})}const g=b(()=>{var i;const e=(i=n==null?void 0:n.scaleStep)!=null?i:0;return(e!=null?e:0>0)?e/100:t.imgScale/10});function S(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&_(g.value),e.delta<0&&_(-g.value)}function _(e){t.imgScale<=.2&&e<0||(t.imgScale+=e)}function D(e){t.imgRotate+=e}function O(){const e=v(f);!e||(e.onmousemove=null)}function T(e){t.status=p.LOADING;const i=new Image;i.src=e,i.onload=r=>{if(t.currentUrl!==e){const d=r.composedPath();if(n.rememberState){l.set(t.currentUrl,{scale:t.imgScale,top:t.imgTop,left:t.imgLeft,rotate:t.imgRotate});const I=l.get(e);I?(t.imgScale=I.scale,t.imgTop=I.top,t.imgRotate=I.rotate,t.imgLeft=I.left):(s(),n.defaultWidth&&(t.imgScale=n.defaultWidth/d[0].naturalWidth))}else n.defaultWidth&&(t.imgScale=n.defaultWidth/d[0].naturalWidth);d&&c("img-load",{index:t.currentIndex,dom:d[0],url:e})}t.currentUrl=e,t.status=p.DONE},i.onerror=r=>{const d=r.composedPath();d&&c("img-error",{index:t.currentIndex,dom:d[0],url:e}),t.status=p.FAIL}}function F(e){e&&e.stopPropagation(),$()}function $(){t.show=!1,document.body.removeEventListener("DOMMouseScroll",S),document.ondragstart=null}function P(){s()}u({resume:P,close:$,prev:y.bind(null,"left"),next:y.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(t.imgScale=e)},setRotate:e=>{t.imgRotate=e}});function y(e){const{currentIndex:i}=t,{imageList:r}=n;e==="left"&&(t.currentIndex--,i<=0&&(t.currentIndex=r.length-1)),e==="right"&&(t.currentIndex++,i>=r.length-1&&(t.currentIndex=0)),T(r[t.currentIndex])}function N(e){e=e||window.event,t.moveX=e.clientX,t.moveY=e.clientY;const i=v(f);i&&(i.onmousemove=U)}function U(e){e=e||window.event,e.preventDefault();const i=e.clientX-t.moveX,r=e.clientY-t.moveY;t.imgLeft+=i,t.imgTop+=r,t.moveX=e.clientX,t.moveY=e.clientY}const W=b(()=>{const{imgScale:e,imgRotate:i,imgTop:r,imgLeft:d}=t;return{transform:`scale(${e}) rotate(${i}deg)`,marginTop:`${r}px`,marginLeft:`${d}px`,maxWidth:n.defaultWidth?"unset":"100%"}}),k=b(()=>{const{imageList:e}=n;return e.length>1});ae(()=>{n.show&&w(),n.imageList&&s()});const X=e=>{n.maskClosable&&e.target&&e.target.classList.contains(`${a}-content`)&&F(e)},G=()=>o("div",{class:`${a}__close`,onClick:F},[o(le,{class:`${a}__close-icon`},null)]),z=()=>{if(!v(k))return null;const{currentIndex:e}=t,{imageList:i}=n;return o("div",{class:`${a}__index`},[e+1,se(" / "),i.length])},V=()=>o("div",{class:`${a}__controller`},[o("div",{class:`${a}__controller-item`,onClick:()=>_(-g.value)},[o("img",{src:Ce},null)]),o("div",{class:`${a}__controller-item`,onClick:()=>_(g.value)},[o("img",{src:ye},null)]),o("div",{class:`${a}__controller-item`,onClick:P},[o("img",{src:be},null)]),o("div",{class:`${a}__controller-item`,onClick:()=>D(-90)},[o("img",{src:xe},null)]),o("div",{class:`${a}__controller-item`,onClick:()=>D(90)},[o("img",{src:Se},null)])]),M=e=>v(k)?o("div",{class:[`${a}__arrow`,e],onClick:()=>y(e)},[e==="left"?o(re,null,null):o(ce,null,null)]):null;return()=>t.show&&o("div",{class:a,ref:h,onMouseup:O,onClick:X},[o("div",{class:`${a}-content`},[o("img",{style:v(W),class:[`${a}-image`,t.status===p.DONE?"":"hidden"],ref:f,src:t.currentUrl,onMousedown:N},null),G(),z(),V(),M("left"),M("right")])])}});let x=null;function Te(n){var l;if(!me)return;const u={},c=document.createElement("div");return Object.assign(u,{show:!0,index:0,scaleStep:100},n),x=o(De,u),ue(x,c),document.body.appendChild(c),(l=x.component)==null?void 0:l.exposed}const Fe=L({name:"FileManagement",components:{BasicTable:j,TableAction:H,BasicUpload:J},setup(){const{t:n}=fe(),{hasPermission:u}=ge(),[c,{reload:l}]=q({api:K,columns:Ie,formConfig:{labelWidth:120,schemas:_e},pagination:!0,striped:!1,useSearchForm:!0,showTableSetting:!0,bordered:!0,showIndexColumn:!1,canResize:!1,actionColumn:{width:100,title:n("common.operateText"),dataIndex:"action",slots:{customRender:"action"}}});function t(s){Z(s.id).then(()=>l())}function h(s){Te({imageList:[s.url]})}function f(s){ee(s.id).then(m=>{var g;we(m.data,decodeURI((g=m==null?void 0:m.headers["content-disposition"])==null?void 0:g.substring(20)))})}function w(){l()}return{t:n,hasPermission:u,uploadApi:Q,registerTable:c,handleDownload:f,handlePreview:h,handleDelete:t,handleSuccess:w}}});function $e(n,u,c,l,t,h){const f=C("BasicUpload"),w=C("TableAction"),s=C("BasicTable");return R(),pe("div",null,[o(s,{onRegister:n.registerTable},{toolbar:E(()=>[n.hasPermission("sys:file:upload")?(R(),ve(f,{key:0,maxSize:20,maxNumber:10,api:n.uploadApi,class:"my-5",emptyHidePreview:!0},null,8,["api"])):he("",!0)]),action:E(({record:m})=>[o(w,{actions:[{icon:"clarity:eye-line",tooltip:n.t("common.previewText"),onClick:n.handlePreview.bind(null,m),ifShow:n.hasPermission("sys:file:download")},{icon:"clarity:download-line",tooltip:n.t("common.downloadText"),onClick:n.handleDownload.bind(null,m),ifShow:n.hasPermission("sys:file:download")},{icon:"ant-design:delete-outlined",color:"error",tooltip:n.t("common.delText"),ifShow:n.hasPermission("sys:file:delete"),popConfirm:{title:n.t("common.delTip"),confirm:n.handleDelete.bind(null,m)}}]},null,8,["actions"])]),_:1},8,["onRegister"])])}var mt=de(Fe,[["render",$e]]);export{mt as default};
